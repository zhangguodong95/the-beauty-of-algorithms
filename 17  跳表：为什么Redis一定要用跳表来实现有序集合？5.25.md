## 17 | 跳表：为什么Redis一定要用跳表来实现有序集合？5.25

跳表(skip list)是一种动态数据结构，他能够在链表的结构上实现时间复杂度为o（logn)的查询、插入和删除。它的实现思想类似于二分查找。

Redis 中的有序集合（Sorted Set）就是用跳表来实现的。如果你有一定基础，应该知道红黑树也可以实现快速的插入、删除和查找操作。那 Redis 为什么会选择用跳表来实现有序集合呢？ 为什么不用红黑树呢？学完今天的内容，你就知道答案了

### 如何理解跳表

**链表加多级索引的结构就是跳表**

![跳表](https://static001.geekbang.org/resource/image/14/8e/14753c824a5ee4a976ea799727adc78e.jpg)

![二级索引](https://static001.geekbang.org/resource/image/49/65/492206afe5e2fef9f683c7cff83afa65.jpg)

### 跳表的时间复杂度

正常的跳表查询，删除，插入的时间复杂度都是logn

### 跳表的空间复杂度

跳表的空间复杂度是o(n),但是实际工程中，索引通常只是原始链表中存储的对象中的一部分数据，如坐标等等，相比较而言是很小的。

### 高效的动态插入和删除

![跳表的插入](https://static001.geekbang.org/resource/image/65/6c/65379f0651bc3a7cfd13ab8694c4d26c.jpg)

如果这个结点在索引中也有出现，我们除了要删除原始链表中的结点，还要删除索引中的。因为单链表中的删除操作需要拿到要删除结点的前驱结点，然后通过指针操作完成删除。所以在查找要删除的结点的时候，一定要获取前驱结点。当然，如果我们用的是双向链表，就不需要考虑这个问题了。

### 跳表索引动态更新

当向跳表中插入数据的时候，我们必须不断更新索引，否则就可能出现某2个节点之间的数据非常多。极端情况下，跳表甚至可能退化成单链表。

![退化的跳表](https://static001.geekbang.org/resource/image/c8/c5/c863074c01c26538cf0134eaf8dc67c5.jpg)

跳表通过随机函数的方式来实现动态更新。实现跳表的索引大小和数据大小平衡性，不至于性能过度退化。

### 内容小结

今天我们讲了跳表这种数据结构。跳表使用空间换时间的设计思路，通过构建多级索引来提高查询的效率，实现了基于链表的“二分查找”。跳表是一种动态数据结构，支持快速的插入、删除、查找操作，时间复杂度都是 O(logn)。

跳表的空间复杂度是 O(n)。不过，跳表的实现非常灵活，可以通过改变索引构建策略，有效平衡执行效率和内存消耗。虽然跳表的代码实现并不简单，但是作为一种动态数据结构，比起红黑树来说，实现要简单多了。所以很多时候，我们为了代码的简单、易读，比起红黑树，我们更倾向用跳表。